<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Blockchain Explorer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0f1215; color: #e9ecef; }
        .blockchain-wrapper {
            display: flex;
            overflow-x: auto;
            padding: 40px 20px;
            gap: 40px;
            align-items: stretch;
        }
        .block-card {
            min-width: 300px;
            width: 300px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
            background: #1c2126;
            border: 2px solid #0dcaf0;
            border-radius: 12px;
            position: relative;
            transition: transform 0.3s;
        }
        .block-card:hover { transform: translateY(-10px); }
        .block-card::after {
            content: "üîó";
            position: absolute;
            right: -32px;
            top: 50%;
            font-size: 20px;
            color: #0dcaf0;
        }
        .block-card:last-child::after { content: ""; }
        .block-header {
            background: #0dcaf0;
            color: #000;
            padding: 8px 15px;
            border-radius: 10px 10px 0 0;
            font-weight: bold;
        }
        .block-body { padding: 15px; font-family: 'Courier New', Courier, monospace; font-size: 0.85rem; flex-grow: 1; display: flex; flex-direction: column;}
        .hash-val { color: #ffc107; word-break: break-all; }
        .status-pill { font-size: 0.7rem; padding: 2px 8px; border-radius: 10px; background: #28a745; }
        .text-secondary {display: block; word-break: break-all; font-size: 0.8rem; }
        .text-info {
            max-height: 120px;
            overflow-y: auto;
            margin-top: 5px;
        }
        .mt-3.text-end.text-muted {
            margin-top: auto !important;
            padding-top: 15px;
        }
    </style>
</head>
<body>

<div class="container-fluid">
    <div class="py-4 px-3 border-bottom border-secondary d-flex justify-content-between">
        <h2>Blockchain Explorer</h2>
        <div id="networkStats" class="text-end">
            <span class="badge bg-primary">Tr·∫°ng th√°i: Active</span>
        </div>
    </div>

    <div class="blockchain-wrapper" id="blockchainExplorer">
        </div>
</div>

<script>
async function refreshExplorer() {
    try {
        const response = await fetch('/api/blockchain/blocks');
        const blocks = await response.json();
        const container = document.getElementById('blockchainExplorer');

        container.innerHTML = blocks.map(block => `
            <div class="block-card shadow">
                <div class="block-header d-flex justify-content-between">
                    <span>BLOCK #${block.index}</span>
                    <span class="status-pill">ƒê√£ x√°c th·ª±c</span>
                </div>
                <div class="block-body">
                    <div class="mb-2">
                        <strong>HASH:</strong><br>
                        <span class="hash-val">${block.hash}</span>
                    </div>
                    <div class="mb-2">
                        <strong>PREV HASH:</strong><br>
                        <span class="text-secondary">${block.previous_hash}</span>
                    </div>
                    <div class="border-top border-secondary pt-2 mt-2">
                        <strong>GIAO D·ªäCH:</strong> ${block.transactions ? block.transactions.length : 0}
                        <div class="mt-1 text-info">
                            ${(block.transactions || []).map(tx => {
                                // X·ª≠ l√Ω l·ªói substring n·∫øu tx kh√¥ng ph·∫£i string
                                const txStr = typeof tx === 'object' ? (tx.id || JSON.stringify(tx)) : String(tx);
                                return `<div>‚Ä¢ ${txStr.substring(0, 20)}...</div>`;
                            }).join('')}
                        </div>
                    </div>
                    <div class="mt-3 text-end" style="font-size: 0.7rem;">
                        Th·ªùi gian: ${new Date(block.timestamp * 1000).toLocaleString()}
                    </div>
                </div>
            </div>
        `).join('');
    } catch (error) {
        console.error("L·ªói Explorer:", error);
    }
}

// C·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªói 5 gi√¢y
setInterval(refreshExplorer, 5000);
refreshExplorer();
</script>
</body>
</html>